#### 1. structure
```
web browser --> nginx --> gunicorn --> django cms for site:www.myblog.com
		     \--> gunicorn --> django cms for site:www.yourblog.com
```

#### 2. deploy steps
##### 2.1 environment
python3

##### 2.2 install python requirements
```
pip install django-cms==3.6.1
pip install djangocms-installer==1.1.0
pip install djangocms-multisite==0.2.0
```

##### 2.3 create and run djangocms project
```
djangocms x_blog
cd x_blog
python manager.py runserver
```
##### 2.4 create two site
- 1. open http://127.0.0.1:8000/admin
- 2. In Home>>Sites>>Sites admin page, add two sites:
  - www.myblog.com
  - www.example.com


##### 2.5 modify setting.py
modify setting.py let project support multisite
diff as follows:
```diff
diff --git a/x_blog/settings.py b/x_blog/settings.py
index 452fd52..d56f9bd 100644
--- a/x_blog/settings.py
+++ b/x_blog/settings.py
@@ -3,12 +3,9 @@ gettext = lambda s: s
 DATA_DIR = os.path.dirname(os.path.dirname(__file__))
 """
 Django settings for x_blog project.
-
 Generated by 'django-admin startproject' using Django 1.11.29.
-
 For more information on this file, see
 https://docs.djangoproject.com/en/1.11/topics/settings/
-
 For the full list of settings and their values, see
 https://docs.djangoproject.com/en/1.11/ref/settings/
 """
@@ -28,7 +25,7 @@ SECRET_KEY = 'e7$0$52p@49io%-q79bzanx9r3lh(ukd!)@kx5u1k2ri6-a@e^'
 # SECURITY WARNING: don't run with debug turned on in production!
 DEBUG = True
 
-ALLOWED_HOSTS = []
+ALLOWED_HOSTS = ["*",]
 
 
 # Application definition
@@ -67,8 +64,9 @@ STATIC_ROOT = os.path.join(DATA_DIR, 'static')
 STATICFILES_DIRS = (
     os.path.join(BASE_DIR, 'x_blog', 'static'),
 )
-SITE_ID = 1
-
+#SITE_ID = 1
+from multisite import SiteID
+SITE_ID = SiteID(default=1)
 
 TEMPLATES = [
     {
@@ -91,7 +89,9 @@ TEMPLATES = [
             'loaders': [
                 'django.template.loaders.filesystem.Loader',
                 'django.template.loaders.app_directories.Loader',
-                'django.template.loaders.eggs.Loader'
+                'django.template.loaders.eggs.Loader',
+                'multisite.template.loaders.filesystem.Loader',
+                'django.template.loaders.app_directories.Loader'
             ],
         },
     },
@@ -99,7 +99,9 @@ TEMPLATES = [
 
 
 MIDDLEWARE = [
+    'multisite.middleware.DynamicSiteMiddleware',
     'cms.middleware.utils.ApphookReloadMiddleware',
+    'djangocms_multisite.middleware.CMSMultiSiteMiddleware',
     'django.contrib.sessions.middleware.SessionMiddleware',
     'django.middleware.csrf.CsrfViewMiddleware',
     'django.contrib.auth.middleware.AuthenticationMiddleware',
@@ -138,7 +140,9 @@ INSTALLED_APPS = [
     'djangocms_snippet',
     'djangocms_googlemap',
     'djangocms_video',
-    'x_blog'
+    'x_blog',
+    'multisite',
+    'djangocms_multisite',
 ]
 
 LANGUAGES = (
@@ -164,6 +168,13 @@ CMS_LANGUAGES = {
     },
 }
 
+MULTISITE_CMS_URLS={
+    'www.myblog.com': 'x_blog.urls',
+    'www.yourblog.com': 'x_blog.urls',
+}
+
+MULTISITE_CMS_FALLBACK='www.myblog.com'
+
 CMS_TEMPLATES = (
     ## Customize this
     ('fullwidth.html', 'Fullwidth'),
@@ -197,3 +208,4 @@ THUMBNAIL_PROCESSORS = (
     'filer.thumbnail_processors.scale_and_crop_with_subject_location',
     'easy_thumbnails.processors.filters'
 )
+

```

##### 2.6 collect static files to /static directory
```
python manage.py collectstatic
```

##### 2.7 run each site's djangocms by gunicorn
```
python deploy/run_two_site.sh
```

##### 2.8 run nginx in docker
1. replace ip address:10.12.169.29 in file deploy/nginx/conf.d/django.conf with your machine's ip address
2. run nginx
```
./deploy/run_nginx.sh
```
##### 2.9 add item to host file
add following items to /etc/hosts
```
127.0.0.1 www.myblog.com
127.0.0.1 www.yourblog.com
```
#### 2.10 finished
visit your site with browser!
